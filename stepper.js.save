// Motor properties.
var gearRatio = 64;
var steps = 32;

var StepperWiringPi = require("stepper-wiringpi");

var motor = StepperWiringPi.setup( steps, 17, 18, 21, 22);

// Speed
motor.setSpeed(1200);

// Useful Vars
var stepsPerRev = ( steps * gearRatio );
var stepPerDegree = stepsPerRev  / 360;

var currentStep = 0;

stepToDeg( 360

, function( currentStep ){
	console.log("Final callback!" + currentStep);
});

// Start stepping by X degrees.
function stepToDeg( degree, callback ){
	motor.halt();

	var steps = degree * stepPerDegree;
	currentStep = 0;

	console.log("stepToDeg() - Stepping to " + degree + " degrees - " + steps + " steps." );

	motorStep( steps, callback );
}

// Recursive function 1 step at a time, keeps count of steps. Callback for finish.
function motorStep( steps, callback ){

	var stepFunc = function(){

		motor.step( 1, function(){
			currentStep += 1;

			if( currentStep == steps ){
				console.log( "stepToDeg() - Completed - Steps = " + steps + " Current Step = " + currentStep );
				callback( currentStep );
			} else {
				stepFunc();
			}
		});
	};
	stepFunc();
}
